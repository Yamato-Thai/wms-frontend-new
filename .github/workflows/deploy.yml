name: Simple Self-Hosted Build

on:
  push:
    branches:
      - master
  workflow_dispatch:

jobs:
  build-only:
    runs-on: self-hosted

    steps:
      # 1) Checkout repository
      - name: Checkout code
        uses: actions/checkout@v4

      # 2) Setup Node.js
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 3) Install dependencies
      - name: Install dependencies
        shell: cmd
        run: npm ci --prefer-offline --no-audit

      # 4) Build Angular
      - name: Build Angular
        shell: cmd
        run: npm run build -- --configuration production

      # 5) Verify build output
      - name: Verify build output
        shell: cmd
        run: |
          if exist dist\wms-frontend-new\browser (
            echo Build successful
          ) else (
            echo Build failed
            exit /b 1
          )

      # 6) Zip output
      - name: Zip build
        shell: cmd
        run: powershell -Command "Compress-Archive -Path 'dist\wms-frontend-new\browser\*' -DestinationPath 'deployment.zip' -Force"
